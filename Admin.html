<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم MTZ - إدارة المنتجات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #1a3a5f; 
            --secondary: #e74c3c; 
            --accent: #3498db; 
            --light: #f8f9fa; 
            --dark: #0d1e30; 
            --gray: #6c757d; 
            --light-gray: #e9ecef; 
            --border: #dee2e6; 
            --success: #27ae60; 
            --warning: #f39c12; 
            --danger: #e74c3c; 
            --card-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); 
            --transition: all 0.3s ease; 
        }
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
        }
        body { 
            font-family: 'Tajawal', Arial, sans-serif; 
            background-color: #f9f9f9; 
            color: #333; 
            line-height: 1.6; 
            overflow-x: hidden; 
        }
        .admin-header { 
            background: linear-gradient(135deg, var(--primary), var(--dark)); 
            color: white; 
            padding: 15px 0; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
        }
        .header-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 15px; 
        }
        .logo { 
            font-size: 24px; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .logo i { 
            color: var(--accent); 
        }
        .admin-nav { 
            display: flex; 
            gap: 15px; 
        }
        .admin-nav a { 
            color: white; 
            text-decoration: none; 
            font-weight: 600; 
            transition: var(--transition); 
            padding: 8px 15px; 
            border-radius: 30px; 
            font-size: 16px; 
        }
        .admin-nav a:hover, .admin-nav a.active { 
            background-color: var(--accent); 
        }
        .admin-container { 
            max-width: 1200px; 
            margin: 30px auto; 
            padding: 0 15px; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 20px; 
        }
        .sidebar { 
            flex: 0 0 250px; 
            background-color: white; 
            border-radius: 15px; 
            box-shadow: var(--card-shadow); 
            padding: 20px; 
            height: fit-content; 
        }
        .sidebar-title { 
            font-size: 20px; 
            color: var(--primary); 
            padding-bottom: 15px; 
            border-bottom: 2px solid var(--light-gray); 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .sidebar-links { 
            list-style: none; 
        }
        .sidebar-links li { 
            margin-bottom: 12px; 
        }
        .sidebar-links a { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 12px 15px; 
            border-radius: 8px; 
            color: var(--dark); 
            text-decoration: none; 
            font-weight: 500; 
            transition: var(--transition); 
        }
        .sidebar-links a:hover, .sidebar-links a.active { 
            background-color: var(--primary); 
            color: white; 
        }
        .sidebar-links a i { 
            width: 24px; 
            text-align: center; 
        }
        .admin-content { 
            flex: 1; 
            min-width: 300px; 
        }
        .page-title { 
            text-align: center; 
            margin-bottom: 30px; 
            color: var(--primary); 
            position: relative; 
            padding-bottom: 15px; 
            font-size: 28px; 
        }
        .page-title::after { 
            content: ''; 
            position: absolute; 
            bottom: 0; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 100px; 
            height: 4px; 
            background-color: var(--secondary); 
            border-radius: 3px; 
        }
        .stats-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: var(--card-shadow); 
            display: flex; 
            align-items: center; 
            gap: 20px; 
        }
        .stat-icon { 
            width: 70px; 
            height: 70px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 30px; 
        }
        .stat-icon.products { 
            background-color: rgba(52, 152, 219, 0.15); 
            color: var(--accent); 
        }
        .stat-icon.orders { 
            background-color: rgba(46, 204, 113, 0.15); 
            color: var(--success); 
        }
        .stat-info h3 { 
            font-size: 24px; 
            margin-bottom: 5px; 
        }
        .admin-table-container { 
            background: white; 
            border-radius: 15px; 
            box-shadow: var(--card-shadow); 
            padding: 25px; 
            margin-bottom: 30px; 
            overflow-x: auto; 
        }
        .table-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
        }
        .btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            background: linear-gradient(135deg, var(--primary), var(--dark)); 
            color: white; 
            padding: 10px 20px; 
            border-radius: 8px; 
            text-decoration: none; 
            font-weight: 600; 
            font-size: 16px; 
            border: none; 
            cursor: pointer; 
        }
        .btn-success { 
            background: linear-gradient(135deg, var(--success), #219653); 
        }
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
        }
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
        }
        .admin-table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 800px; 
        }
        .admin-table th, .admin-table td { 
            padding: 15px; 
            text-align: center; 
            border-bottom: 1px solid var(--light-gray); 
        }
        .admin-table th { 
            background-color: var(--primary); 
            color: white; 
        }
        .product-image { 
            width: 80px; 
            height: 80px; 
            object-fit: cover; 
            border-radius: 8px; 
        }
        .form-container { 
            background: white; 
            border-radius: 15px; 
            box-shadow: var(--card-shadow); 
            padding: 30px; 
            margin-bottom: 30px; 
            display:none; 
        }
        .form-row { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .form-group { 
            flex: 1 1 45%; 
        }
        .form-group-full { 
            flex: 1 1 100%; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: var(--primary); 
        }
        .form-control { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid var(--border); 
            border-radius: 8px; 
        }
        .form-check-group { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            padding: 10px; 
            border: 1px solid var(--border); 
            border-radius: 8px; 
        }
        .form-check { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .color-box { 
            width: 20px; 
            height: 20px; 
            border-radius: 4px; 
            border: 1px solid var(--border); 
        }
        .image-input-row { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .image-preview { 
            width: 50px; 
            height: 50px; 
            object-fit: cover; 
            border-radius: 6px; 
        }
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 14px;
        }
        .active-badge {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        .inactive-badge {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        .featured-badge {
            background-color: rgba(241, 196, 15, 0.2);
            color: var(--warning);
        }
        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .badge-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .badge-option {
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            border: 1px solid var(--border);
        }
        .badge-option.selected {
            background-color: var(--primary);
            color: white;
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-tshirt"></i> 
                <span>MTZ لوحة التحكم</span>
            </div>
        </div>
    </header>
    <div class="admin-container">
        <div class="sidebar">
            <h2 class="sidebar-title"><i class="fas fa-bars"></i> القائمة</h2>
            <ul class="sidebar-links">
                <li><a href="#" class="active"><i class="fas fa-tshirt"></i> المنتجات</a></li>
            </ul>
        </div>
        <div class="admin-content">
            <h1 class="page-title">إدارة المنتجات</h1>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon products"><i class="fas fa-tshirt"></i></div>
                    <div class="stat-info">
                        <h3 id="products-count">0</h3>
                        <p>المنتجات</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orders"><i class="fas fa-shopping-cart"></i></div>
                    <div class="stat-info">
                        <h3>0</h3>
                        <p>الطلبات</p>
                    </div>
                </div>
            </div>
            <div class="admin-table-container">
                <div class="table-header">
                    <h2><i class="fas fa-list"></i> قائمة المنتجات</h2>
                    <button class="btn btn-success" id="add-product-btn"><i class="fas fa-plus"></i> إضافة منتج جديد</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>الصورة</th>
                            <th>المنتج</th>
                            <th>السعر</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="products-table-body"></tbody>
                </table>
            </div>
            <div class="form-container" id="product-form">
                <h2 id="form-title"></h2>
                <form id="product-form-data">
                    <input type="hidden" id="product-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>اسم المنتج</label>
                            <input type="text" id="product-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>السعر الأصلي</label>
                            <input type="number" id="product-price" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>السعر المعروض</label>
                            <input type="text" id="display-price" class="form-control" placeholder="مثال: 2000 دينار">
                        </div>
                        <div class="form-group">
                            <label>التقييم (1-5)</label>
                            <input type="number" id="product-rating" class="form-control" step="0.1" min="1" max="5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>عدد المقيّمين</label>
                            <input type="number" id="product-ratingCount" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>الشارة</label>
                            <div class="badge-selector">
                                <div class="badge-option" data-badge="">بدون شارة</div>
                                <div class="badge-option" data-badge="جديد">جديد</div>
                                <div class="badge-option" data-badge="الأكثر مبيعاً">الأكثر مبيعاً</div>
                                <div class="badge-option" data-badge="مميز">مميز</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group-full">
                        <label>الوصف</label>
                        <textarea id="product-description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group-full">
                        <label>الصور</label>
                        <div id="image-inputs-container"></div>
                        <button type="button" class="btn" id="add-image-btn" style="background:var(--accent);">
                            <i class="fas fa-plus"></i> إضافة صورة
                        </button>
                    </div>
                    <div class="form-group-full">
                        <label>الألوان</label>
                        <div id="color-options-container" class="form-check-group"></div>
                    </div>
                    <div class="form-group-full">
                        <label>المقاسات</label>
                        <div id="size-options-container" class="form-check-group"></div>
                    </div>
                    <div style="background:#fffbe6; padding:15px; border-radius:8px; margin:20px 0;">
                        <h4 style="color:#856404;">عرض خاص</h4>
                        <div class="form-check">
                            <input type="checkbox" id="on-sale" class="form-check-input">
                            <label for="on-sale">تفعيل العرض</label>
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="sale-price">السعر بعد التخفيض</label>
                            <input type="number" id="product-salePrice" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-check">
                            <input type="checkbox" id="active" class="form-check-input" checked>
                            <label for="active">منتج نشط</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="featured" class="form-check-input">
                            <label for="featured">منتج مميز (يظهر في الصفحة الرئيسية)</label>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <button type="submit" class="btn btn-success">حفظ</button>
                        <button type="button" class="btn btn-danger" id="cancel-form-btn">إلغاء</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        const ALL_COLORS = { 
            'blue': '#3498db', 
            'black': '#2c3e50', 
            'white': '#ffffff', 
            'red': '#e74c3c', 
            'gray': '#95a5a6',
            'green': '#27ae60',
            'beige': '#f5d7bf'
        };
        
        const ALL_SIZES = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
        const ALL_BADGES = ['', 'جديد', 'الأكثر مبيعاً', 'مميز', 'عرض خاص'];

        // وظائف لإدارة المنتجات في localStorage
        function getProducts() { 
            return JSON.parse(localStorage.getItem('mtz-products')) || []; 
        }
        
        function saveProducts(products) { 
            localStorage.setItem('mtz-products', JSON.stringify(products)); 
            // تحديث علامة التعديل لتنبيه الموقع الرسمي
            localStorage.setItem('mtz-products-updated', Date.now());
        }

        // عرض المنتجات في الجدول
        function renderTable() {
            const products = getProducts();
            document.getElementById('products-count').textContent = products.length;
            const tableBody = document.getElementById('products-table-body');
            tableBody.innerHTML = '';
            
            products.forEach((p, i) => {
                const imageUrl = (Array.isArray(p.images) && p.images.length > 0) ? p.images[0] : '';
                const priceHtml = p.onSale && p.salePrice > 0 ? 
                    `<s>${p.price} د.ج</s> <strong style="color:var(--danger)">${p.salePrice} د.ج</strong>` : 
                    `${p.price} د.ج`;
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td><img src="${imageUrl}" class="product-image" onerror="this.src='https://via.placeholder.com/80?text=No+Image'"></td>
                    <td>${p.name}</td>
                    <td>${priceHtml}</td>
                    <td>
                        <span class="status-badge ${p.active ? 'active-badge' : 'inactive-badge'}">
                            ${p.active ? 'نشط' : 'غير نشط'}
                        </span>
                        ${p.featured ? '<span class="status-badge featured-badge">مميز</span>' : ''}
                    </td>
                    <td>
                        <button class="btn btn-warning" onclick="editProduct(${i})">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct(${i})">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </td>
                `;
            });
        }

        // إظهار/إخفاء نموذج المنتج
        function toggleForm(show = false) { 
            document.getElementById('product-form').style.display = show ? 'block' : 'none'; 
        }

        // إعداد نموذج المنتج للتحرير أو الإضافة
        function setupForm(product = null) {
            document.getElementById('product-form-data').reset();
            document.getElementById('form-title').textContent = product ? 'تعديل المنتج' : 'إضافة منتج جديد';
            
            document.getElementById('product-id').value = product?.id || '';
            document.getElementById('product-name').value = product?.name || '';
            document.getElementById('product-price').value = product?.price || '';
            document.getElementById('display-price').value = product?.displayPrice || '';
            document.getElementById('product-salePrice').value = product?.salePrice || '';
            document.getElementById('product-description').value = product?.description || '';
            document.getElementById('product-rating').value = product?.rating || 5;
            document.getElementById('product-ratingCount').value = product?.ratingCount || 0;
            document.getElementById('active').checked = product ? product.active : true;
            document.getElementById('featured').checked = product?.featured || false;
            document.getElementById('on-sale').checked = product?.onSale || false;
            
            // تحديد الشارة المختارة
            const badgeOptions = document.querySelectorAll('.badge-option');
            badgeOptions.forEach(option => {
                const badgeValue = option.getAttribute('data-badge');
                option.classList.toggle('selected', badgeValue === (product?.badge || ''));
            });
            
            // إعداد خيارات الألوان
            const populateChecks = (containerId, allOptions, selected, type) => {
                const container = document.getElementById(containerId); 
                container.innerHTML = '';
                
                const options = type === 'color' ? 
                    Object.entries(allOptions) : 
                    allOptions.map(o => [o, o]);
                
                options.forEach(([value, display]) => {
                    const colorBox = type === 'color' ? 
                        `<div class="color-box" style="background-color:${display};"></div>` : '';
                    
                    container.innerHTML += `
                        <div class="form-check">
                            <input type="checkbox" id="${type}-${value}" value="${value}" 
                                class="form-check-input" ${selected?.includes(value) ? 'checked' : ''}>
                            <label for="${type}-${value}">${value}</label>
                            ${colorBox}
                        </div>
                    `;
                });
            };
            
            populateChecks('color-options-container', ALL_COLORS, product?.colors, 'color');
            populateChecks('size-options-container', ALL_SIZES, product?.sizes, 'size');
            
            // إعداد حقول الصور
            const imgContainer = document.getElementById('image-inputs-container');
            imgContainer.innerHTML = '';
            (product?.images || ['']).forEach(url => addImageInput(url));
            
            toggleForm(true);
        }
        
        // إضافة حقل لصورة جديدة
        function addImageInput(url = '') {
            const container = document.getElementById('image-inputs-container');
            const row = document.createElement('div');
            row.className = 'image-input-row';
            
            row.innerHTML = `
                <input type="text" class="form-control image-url-input" value="${url}" 
                    placeholder="رابط الصورة">
                <img src="${url || 'https://via.placeholder.com/50?text=صورة'}" 
                    class="image-preview" onerror="this.src='https://via.placeholder.com/50?text=خطأ'">
                <button type="button" class="btn btn-danger" style="padding: 5px 10px;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // تحديث معاينة الصورة عند تغيير الرابط
            row.querySelector('input').addEventListener('input', function(e) {
                row.querySelector('img').src = e.target.value || 'https://via.placeholder.com/50?text=صورة';
            });
            
            // إزالة حقل الصورة
            row.querySelector('button').addEventListener('click', function() {
                row.remove();
            });
            
            container.appendChild(row);
        }
        
        // تحرير منتج
        function editProduct(index) { 
            setupForm(getProducts()[index]); 
        }
        
        // حذف منتج
        function deleteProduct(index) { 
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟ لا يمكن التراجع عن هذا الإجراء.')) { 
                const products = getProducts(); 
                products.splice(index, 1); 
                saveProducts(products); 
                renderTable(); 
            } 
        }
        
        // تهيئة الصفحة عند التحميل
        document.addEventListener('DOMContentLoaded', () => {
            // عرض المنتجات في الجدول
            renderTable();
            
            // إعداد زر إضافة منتج جديد
            document.getElementById('add-product-btn').addEventListener('click', () => setupForm(null));
            
            // إعداد زر إلغاء النموذج
            document.getElementById('cancel-form-btn').addEventListener('click', () => toggleForm(false));
            
            // إعداد زر إضافة صورة
            document.getElementById('add-image-btn').addEventListener('click', () => addImageInput());
            
            // إعداد اختيار الشارة
            document.querySelectorAll('.badge-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.badge-option').forEach(opt => 
                        opt.classList.remove('selected')
                    );
                    this.classList.add('selected');
                });
            });
            
            // إعداد إرسال النموذج
            document.getElementById('product-form-data').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const products = getProducts();
                const productId = document.getElementById('product-id').value;
                const getFormValue = id => document.getElementById(id).value;
                const getCheckedValues = containerId => 
                    Array.from(document.querySelectorAll(`#${containerId} input:checked`))
                    .map(el => el.value);
                
                // الحصول على الشارة المختارة
                const selectedBadge = document.querySelector('.badge-option.selected');
                const badgeValue = selectedBadge ? selectedBadge.getAttribute('data-badge') : '';
                
                // جمع بيانات المنتج
                const productData = {
                    id: productId || 'p' + Date.now(),
                    name: getFormValue('product-name'),
                    price: parseFloat(getFormValue('product-price')),
                    displayPrice: getFormValue('display-price') || getFormValue('product-price') + ' دينار',
                    salePrice: parseFloat(getFormValue('product-salePrice')) || 0,
                    description: getFormValue('product-description'),
                    images: Array.from(document.querySelectorAll('.image-url-input'))
                        .map(el => el.value.trim())
                        .filter(Boolean),
                    colors: getCheckedValues('color-options-container'),
                    sizes: getCheckedValues('size-options-container'),
                    active: document.getElementById('active').checked,
                    featured: document.getElementById('featured').checked,
                    onSale: document.getElementById('on-sale').checked,
                    rating: parseFloat(getFormValue('product-rating')) || 5,
                    ratingCount: parseInt(getFormValue('product-ratingCount')) || 0,
                    badge: badgeValue,
                    date: new Date().toISOString().split('T')[0]
                };
                
                // تحديث المنتج الحالي أو إضافة منتج جديد
                const index = products.findIndex(p => p.id === productId);
                if (index > -1) {
                    products[index] = { ...products[index], ...productData };
                } else {
                    products.unshift(productData);
                }
                
                // حفظ المنتجات وعرض الجدول
                saveProducts(products);
                renderTable();
                toggleForm(false);
            });
        });
    </script>
</body>
</html>